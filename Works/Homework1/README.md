# Домашнее задание 1

Я решил сделать закачку документов на Python, потому что он имеет удобные библиотеки для анализа html-файлов(BeautifulSoup 4 в моём случае), ну и т.к. узким горлышком в данном случае всё равно будет количество обрабатываемых за секунду страниц больше количества скачиваемых.

## Идея
Т.к. закачка и обработка страниц идут с разной скоростью, то я решил сделать 2 скрипта:

1. Загрузчик берет из очереди сообщений URL, скачивает его и  передает обработчику
2. Обработчик просматривает документы переданные загрузчиком и выделяет из них ссылки на другие документы, если ссылка не обработана и не лежит в черном списке(Википедия), то передаем ссылку загрузчику

## Детали реализации

В качестве очереди сообщений я решил использовать ZeroMQ, т.к. она максимально легковесная и не требует дополнительных действий, кроме установки библиотеки(В отличие от Kafka)

Хеши обработанных ссылок буду хранить в множестве(set), сами ссылки хранить не буду, т.к. при количестве документов порядна миллиона может не хватить памяти

### Оптимизация памяти

Небольшой тест показал, что простое сохранение html страничек приводит, к тому, что  ~500 файлов занимают ~250М памяти. В таком случае сохранить миллионы документов просто не получится(понадобится примерно 500Г памяти).

Поэтому я буду хранить только сырой текст, который занимает ~5% от всего объёма html документа

После небольшого теста стало понятно, что на загрузку 1000 документов в однопоточном режиме требуется ~10 минут времени, что явно недостаточно для миллиона документов.

Поэтому я решил сделать многопоточную загрузку. Для этого я описал еще один скрипт для равномерного распределения запросов на скачивание между загрузчиками

При условии, что загрузчики загружают примерно равное количество документов в секунду, то для каждого конкретного загрузчика надо разделить количество документов для загрузки на количество загрузчиков

Также в балансировщик переместил хранилище хешей обработанных ссылок и поставил там же фильтр, чтобы уже обработанные ссылки не проходили к загрузчику
